import{m as _,a as T}from"./pinia-7d28dea6.js";import{c as h}from"./cart-91a72be6.js";import{s as L}from"./statusStore-fedbabd5.js";import{L as A}from"./vue-loading-overlay-67898897.js";import{S as v}from"./sweetalert2-fc38d252.js";import{aM as c,aC as m,W as p,a3 as n,X as e,bj as g,F as E,aK as B,bl as V,bc as w,bo as j,aZ as u,a1 as I,a2 as N,ar as f}from"./@vue-a2e6aab2.js";import{_ as q}from"./index-90e19ebd.js";import"./vue-demi-71ba0ef2.js";import"./axios-08622986.js";import"./@ckeditor-b092e1d3.js";import"./vue-71628d3f.js";import"./vue-router-49be82a2.js";import"./vue-axios-58a7c26f.js";import"./bootstrap-8396874d.js";import"./@popperjs-9847b28c.js";import"./vee-validate-aa725db8.js";import"./@vee-validate-55db0f47.js";const{VITE_APP_URL:C,VITE_APP_PATH:k}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/test-github/",MODE:"production",DEV:!1,PROD:!0},D={data(){return{form:{email:"",name:"",phone:"",address:"",region:"",msg:""},couponCode:"",discount:0,discoutStatus:!1}},computed:{..._(h,["carts"]),..._(h,["final_total"]),..._(h,["total","isLoading"]),..._(L,["isLoading"])},methods:{...T(h,["getCarts"]),validateTelephone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"請輸入09開頭的手機號碼"},sendCoupon(l){this.couponCode=l;const o={code:this.couponCode};console.log(o),this.$http.post(`${C}v2/api/${k}/coupon`,{data:o}).then(a=>{console.log(a),this.discoutStatus=a.data.success,v.fire({position:"top-end",icon:"success",title:a.data.message,showConfirmButton:!1,timer:1500})}).catch(a=>(v.fire({position:"top-end",icon:"error",title:a.response.data.message,showConfirmButton:!1,timer:1500}),0)),this.couponCode=""},sendOrder(){if(console.log(this.carts.length),this.carts.length===0)alert("購物車清單內為空");else{const l={user:{name:this.form.name,email:this.form.email,tel:this.form.phone,address:this.form.address},message:this.form.msg},o=this.$loading.show();this.$http.post(`${C}v2/api/${k}/order`,{data:l}).then(a=>{console.log("送出訂單:",a),this.getCarts(),this.loadingItem="",this.$refs.form.resetForm(),v.fire({position:"top-end",icon:"success",title:"訂單已送出",showConfirmButton:!1,timer:1500}),this.$router.push(`/complete/${a.data.orderId}`),o.hide()}).catch(a=>{v.fire({position:"top-end",icon:"error",title:a.response.data.message,showConfirmButton:!1,timer:1500})})}}},components:{Loading:A},mounted(){this.getCarts()}},M={class:"container py-8"},O=I('<h2 class="text-center fw-bold text-primary mb-7">填寫訂單</h2><div class="pt-4 pb-3"><div class="container"><div class="row justify-content-center"><div class="col-9 col-md-7 timeline"></div></div><div class="row"><div class="col-3 col-md-5"><div class="timeline-pointer text-center step-1 active"><p>購物清單確認</p></div></div><div class="col-6 col-md-2"><div class="timeline-pointer text-center step-2 active"><p>填寫訂單</p></div></div><div class="col-3 col-md-5"><div class="timeline-pointer text-center step-3"><p>購物完成</p></div></div></div></div></div>',2),R={class:"row g-0 g-md-3 justify-content-center flex-column flex-md-row"},F={class:"col-md-9 mb-3 d-flex flex-column justify-content-between"},H={class:"row g-0 g-md-3"},X={class:"col-md-6"},z=e("span",{class:"material-icons"},"keyboard_return",-1),K={class:"border p-2 h-100"},W=e("h3",{class:"text-center fw-bold text-primary"},"訂單明細",-1),Z={class:"col-4"},G=["src"],J={class:"col-3"},Q={class:"fs-6 fs-md-4 mb-0"},Y={class:"col-3 text-end"},$={class:"fs-6 fs-md-4 noto-serif-font"},ee={class:"col-2 text-end"},oe={class:"col-2 fs-6 fs-md-4"},se={class:"d-flex justify-content-center"},te={class:"d-flex justify-content-between fs-5"},le=e("span",null,"總和",-1),ie={key:0,class:"fw-bold noto-serif-font text-danger"},ne={key:1,class:"fw-bold noto-serif-font text-danger"},ae={class:"col-md-6"},re={class:"p-2"},de=e("h3",{class:"text-center fw-bold text-primary"},"顧客資訊",-1),ce={class:"mb-3"},me=e("label",{for:"customer-name",class:"form-label"},"姓名",-1),pe={class:"mb-3"},ue=e("label",{for:"customer-emall",class:"form-label"},"Email",-1),fe={class:"mb-3"},_e=e("label",{for:"customer-phone",class:"form-label"},"電話",-1),he={class:"mb-3"},ve=e("label",{for:"customer-address",class:"form-label"},"地址",-1),be={class:"mb-3"},ge=e("label",{for:"customer-pay",class:"form-label"},"付款方式",-1),ye=e("option",{value:"",disabled:""},"請選擇",-1),xe=e("option",{value:"1"},"ATM",-1),Ve=e("option",{value:"2"},"Cradit Card",-1),we=e("option",{value:"3"},"samsung pay",-1),Ce={class:"mb-3"},ke=e("label",{for:"customer-note",class:"form-label"},"備註",-1),Se=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1);function Ue(l,o,a,Pe,s,b){const S=c("loading"),U=c("router-link"),r=c("v-field"),d=c("error-message"),P=c("v-form");return m(),p("div",M,[n(S,{active:l.isLoading,"onUpdate:active":o[0]||(o[0]=t=>l.isLoading=t)},null,8,["active"]),O,e("div",R,[e("div",F,[e("div",H,[e("div",X,[n(U,{to:"/cart",class:"d-flex align-items-center text-decoration-none"},{default:g(()=>[z,N(" 回購物車列表 ")]),_:1}),e("div",K,[W,(m(!0),p(E,null,B(l.carts.carts,t=>{var i,y,x;return m(),p("div",{class:"d-flex align-items-center mb-4 shadow-sm p-2",key:t.id},[e("div",Z,[e("img",{class:"col-4 object-fit p-1 w-100 img-fluid",src:(i=t.product)==null?void 0:i.imageUrl,alt:"order-img",height:"150"},null,8,G)]),e("div",J,[e("span",Q,u((y=t.product)==null?void 0:y.title),1)]),e("div",Y,[e("span",$,u(l.$filters.currency((x=t.product)==null?void 0:x.price)),1)]),e("div",ee,[e("span",oe,"X"+u(t.qty),1)])])}),128)),e("div",se,[V(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=t=>s.couponCode=t)},null,512),[[w,s.couponCode]]),e("button",{class:"btn btn-primary text-nowrap",type:"button",onClick:o[2]||(o[2]=j(()=>b.sendCoupon(s.couponCode),["prevent"]))},"套用優惠碼")]),e("div",te,[le,s.discoutStatus?(m(),p("span",ie,u(l.$filters.currency(l.final_total)),1)):(m(),p("span",ne,u(l.$filters.currency(l.total)),1))])])]),e("div",ae,[n(P,{ref:"form",onSubmit:b.sendOrder},{default:g(({errors:t})=>[e("div",re,[de,e("div",ce,[me,n(r,{type:"text",name:"姓名",class:f(["form-control",{"is-invalid":t.姓名}]),id:"customer-name",placeholder:"請填寫姓名",rules:"required",modelValue:s.form.name,"onUpdate:modelValue":o[3]||(o[3]=i=>s.form.name=i)},null,8,["class","modelValue"]),n(d,{name:"姓名",class:"invalid-feedback"})]),e("div",pe,[ue,n(r,{type:"email",name:"信箱",class:f(["form-control",{"is-invalid":t.信箱}]),id:"customer-emall",placeholder:"name@example.com",rules:"email|required",modelValue:s.form.email,"onUpdate:modelValue":o[4]||(o[4]=i=>s.form.email=i)},null,8,["class","modelValue"]),n(d,{name:"信箱",class:"invalid-feedback"})]),e("div",fe,[_e,n(r,{type:"tel",name:"電話",class:f(["form-control",{"is-invalid":t.電話}]),id:"customer-phone",placeholder:"0912345678",rules:b.validateTelephone,modelValue:s.form.phone,"onUpdate:modelValue":o[5]||(o[5]=i=>s.form.phone=i)},null,8,["class","rules","modelValue"]),n(d,{name:"電話",class:"invalid-feedback"})]),e("div",he,[ve,n(r,{type:"text",name:"地址",class:f(["form-control",{"is-invalid":t.地址}]),id:"customer-address",placeholder:"請輸入地址",rules:"required",modelValue:s.form.address,"onUpdate:modelValue":o[6]||(o[6]=i=>s.form.address=i)},null,8,["class","modelValue"]),n(d,{name:"地址",class:"invalid-feedback"})]),e("div",be,[ge,n(r,{id:"customer-pay",name:"付款方式",class:f(["form-control",{"is-invalid":t.付款方式}]),rules:"required",modelValue:s.form.region,"onUpdate:modelValue":o[7]||(o[7]=i=>s.form.region=i),as:"select"},{default:g(()=>[ye,xe,Ve,we]),_:2},1032,["class","modelValue"]),n(d,{name:"付款方式",class:"invalid-feedback"})]),e("div",Ce,[ke,V(e("textarea",{class:"form-control",id:"customer-note",rows:"3","onUpdate:modelValue":o[8]||(o[8]=i=>s.form.msg=i)},null,512),[[w,s.form.msg]])]),Se])]),_:1},8,["onSubmit"])])])])])])}const Ke=q(D,[["render",Ue]]);export{Ke as default};
