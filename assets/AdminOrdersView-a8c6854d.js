import{m as V,D as E}from"./DelModal-1fd2db91.js";import{aC as o,W as n,X as t,a2 as B,aZ as s,U as O,F as m,aK as k,bl as w,b8 as $,aM as f,a3 as b,ar as A}from"./@vue-a2e6aab2.js";import{_ as M}from"./index-90e19ebd.js";import{P as S}from"./PaginationView-924a1c4c.js";import{S as _}from"./sweetalert2-fc38d252.js";import"./bootstrap-8396874d.js";import"./@popperjs-9847b28c.js";import"./@ckeditor-b092e1d3.js";import"./vue-71628d3f.js";import"./pinia-7d28dea6.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-49be82a2.js";import"./axios-08622986.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-67898897.js";import"./vee-validate-aa725db8.js";import"./@vee-validate-55db0f47.js";const T={props:["order"],data(){return{tempOrder:{},isPaid:!1}},methods:{changestatus(r){this.$emit("change-status",r)}},watch:{order(){this.tempOrder=this.order}},mixins:[V]},U={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},L={class:"modal-dialog modal-xl",role:"document"},N={class:"modal-content border-0"},I=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},q={class:"row"},F={class:"col-md-4"},H=t("h3",null,"用戶資料",-1),j={class:"table"},z={key:0},K=t("th",{style:{width:"100px"}},"姓名",-1),W=t("th",null,"Email",-1),X=t("th",null,"電話",-1),Z=t("th",null,"地址",-1),G={class:"col-md-8"},J=t("h3",null,"訂單細節",-1),Q={class:"table"},Y=t("th",{style:{width:"100px"}},"訂單編號",-1),tt=t("th",null,"下單時間",-1),et=t("th",null,"付款時間",-1),st={key:0},ot={key:1},nt=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},lt={key:1,class:"text-muted"},dt=t("th",null,"總金額",-1),at=t("h3",null,"選購商品",-1),it={class:"table"},ct=t("thead",null,[t("tr")],-1),pt={class:"text-end"},ht={class:"d-flex justify-content-end"},_t={class:"form-check"},ut={class:"form-check-label",for:"flexCheckDefault"},mt={key:0},ft={key:1},bt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function yt(r,l,a,p,e,c){return o(),n("div",U,[t("div",L,[t("div",N,[I,t("div",R,[t("div",q,[t("div",F,[B(s(e.tempOrder.paid_date)+" ",1),H,t("table",j,[e.tempOrder.user?(o(),n("tbody",z,[t("tr",null,[K,t("td",null,s(e.tempOrder.user.name),1)]),t("tr",null,[W,t("td",null,s(e.tempOrder.user.email),1)]),t("tr",null,[X,t("td",null,s(e.tempOrder.user.tel),1)]),t("tr",null,[Z,t("td",null,s(e.tempOrder.user.address),1)])])):O("",!0)])]),t("div",G,[J,t("table",Q,[t("tbody",null,[t("tr",null,[Y,t("td",null,s(e.tempOrder.id),1)]),t("tr",null,[tt,t("td",null,s(r.$filters.date(e.tempOrder.create_at)),1)]),t("tr",null,[et,t("td",null,[e.tempOrder.paid_date?(o(),n("span",st,s(r.$filters.date(e.tempOrder.paid_date)),1)):(o(),n("span",ot,"時間不正確"))])]),t("tr",null,[nt,t("td",null,[e.tempOrder.is_paid?(o(),n("strong",rt,"已付款")):(o(),n("span",lt,"尚未付款"))])]),t("tr",null,[dt,t("td",null,s(r.$filters.currency(e.tempOrder.total)),1)])])]),at,t("table",it,[ct,t("tbody",null,[(o(!0),n(m,null,k(e.tempOrder.products,i=>{var u;return o(),n("tr",{key:i.id},[t("th",null,s((u=i.product)==null?void 0:u.title),1),t("td",null,s(i.qty)+" / "+s(i.product.unit),1),t("td",pt,s(i.final_Total),1)])}),128))])]),t("div",ht,[t("div",_t,[w(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":l[0]||(l[0]=i=>e.tempOrder.is_paid=i)},null,512),[[$,e.tempOrder.is_paid]]),t("label",ut,[e.tempOrder.is_paid?(o(),n("span",mt,"已付款")):(o(),n("span",ft,"未付款"))])])])])])]),t("div",bt,[gt,t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=()=>c.changestatus(e.tempOrder))}," 修改付款狀態 ")])])])],512)}const Ot=M(T,[["render",yt]]),{VITE_APP_URL:g,VITE_APP_PATH:y}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/test-github/",MODE:"production",DEV:!1,PROD:!0},kt={data(){return{orders:{},isNew:!1,pagination:{},tempOrder:{}}},methods:{getOrders(r=1){const l=this.$loading.show();this.$http.get(`${g}v2/api/${y}/admin/orders/?page=${r}`).then(a=>{this.orders=a.data.orders,this.pagination=a.data.pagination,l.hide()}).catch(a=>{_.fire({position:"top-end",icon:"error",title:a.response.data.message,showConfirmButton:!1,timer:1500}),l.hide()})},openModal(r,l){r==="look"?(this.tempOrder={...l},this.isNew=!1,this.$refs.orderModal.openModal()):r==="delete"&&(this.tempOrder={...l},this.$refs.orderdelModal.openModal())},updatePaid(r){const l=`${g}v2/api/${y}/admin/order/${r.id}`,a={is_paid:r.is_paid};this.$http.put(l,{data:a}).then(p=>{_.fire({position:"top-end",icon:"success",title:p.data.message,showConfirmButton:!1,timer:1500}),this.$refs.orderModal.hideModal()}).catch(p=>{_.fire({position:"top-end",icon:"error",title:p.response.data.message,showConfirmButton:!1,timer:1500})})},deleteOrder(){const r=`${g}v2/api/${y}/admin/order/${this.tempOrder.id}`;this.$http.delete(r).then(l=>{_.fire({position:"top-end",icon:"success",title:l.data.message,showConfirmButton:!1,timer:1500}),this.$refs.orderdelModal.hideModal(),this.getOrders()}).catch(l=>{_.fire({position:"top-end",icon:"error",title:l.response.data.message,showConfirmButton:!1,timer:1500})})}},components:{OrderModal:Ot,DelModal:E,Pagination:S},mounted(){this.getOrders(),document.title=this.$route.meta.title}},xt={class:"col-md-9 ms-sm-auto col-lg-10 px-md-4"},Ct={class:"py-3"},wt={class:"table-responsive"},$t={class:"table mt-4"},Mt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",{class:"text-nowrap"},"Email"),t("th",{class:"text-nowrap"},"購買款項"),t("th",{class:"text-nowrap"},"應付金額"),t("th",{class:"text-nowrap"},"是否付款"),t("th",{class:"text-nowrap"},"操作行為")])],-1),vt={class:"text-nowrap"},Pt=["textContent"],Dt={class:"text-nowrap"},Vt={class:"text-right text-nowrap"},Et={class:"text-nowrap"},Bt={class:"form-check form-switch"},At=["id","onUpdate:modelValue","onChange"],St=["for"],Tt={key:0},Ut={key:1},Lt={class:"text-nowrap"},Nt={class:"btn-group"},It=["onClick"],Rt=["onClick"];function qt(r,l,a,p,e,c){const i=f("OrderModal"),u=f("DelModal"),v=f("Pagination");return o(),n("main",xt,[t("div",Ct,[t("div",wt,[t("table",$t,[Mt,t("tbody",null,[(o(!0),n(m,null,k(e.orders,(d,P)=>(o(),n(m,{key:P},[e.orders.length?(o(),n("tr",{key:0,class:A({"text-secondary":!d.is_paid})},[t("td",null,s(r.$filters.date(d.create_at)),1),t("td",vt,[d.user?(o(),n("span",{key:0,textContent:s(d.user.email)},null,8,Pt)):O("",!0)]),t("td",Dt,[(o(!0),n(m,null,k(d.products,(h,D)=>{var x,C;return o(),n("ul",{class:"list-unstyled",key:D},[t("li",null,s((x=h.product)==null?void 0:x.title)+" 數量："+s(h.qty)+" "+s((C=h.product)==null?void 0:C.unit),1)])}),128))]),t("td",Vt,s(r.$filters.currency(d.total)),1),t("td",Et,[t("div",Bt,[w(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":h=>d.is_paid=h,onChange:()=>c.updatePaid(d)},null,40,At),[[$,d.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${d.id}`},[d.is_paid?(o(),n("span",Tt,"已付款")):(o(),n("span",Ut,"未付款"))],8,St)])]),t("td",Lt,[t("div",Nt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:()=>c.openModal("look",d)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:()=>c.openModal("delete",d)}," 刪除 ",8,Rt)])])],2)):O("",!0)],64))),128))])]),b(i,{ref:"orderModal",order:e.tempOrder,onChangeStatus:c.updatePaid},null,8,["order","onChangeStatus"]),b(u,{ref:"orderdelModal","temp-items":e.tempOrder,onDeleteData:c.deleteOrder,id:2},null,8,["temp-items","onDeleteData"]),b(v,{pages:e.pagination,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"])])])])}const re=M(kt,[["render",qt]]);export{re as default};
